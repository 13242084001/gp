# coding=utf-8
import requests
import random
import io
import logging
import json
import datetime, time, sys
from statistics import mean
# 选择站上所有均线的票，日k，周k
#sys.stdout = io.TextIOWrapper(io.BufferedWriter(sys.stdout.buffer, 5), encoding='utf-8')

logging.basicConfig(level=logging.DEBUG, format="%(message)s", filename="./aaa_2.log", filemode="a")



"""
code_all_url = "https://stockapi.com.cn/v1/base/all?token=a20428f5bc97e60c6918a15e032079b41a3872df60575e1d"
code_all_list = requests.get(url=code_all_url).json().get("data")
print(len(code_all_list))
code_list = []
for code in code_all_list:
    if code.get("api_code")[:2] in ["60", "00"] and ("ST" not in code.get("name")):
        code_list.append(code.get("api_code"))
print(code_list)
print(len(code_list))
"""

code_list = ['603122', '002031', '000887', '000993', '603278', '002517', '002515', '002653', '002063', '002268', '000630', '600030', '000902', '601108', '605289', '600057', '600814', '605507', '601212', '601086',
 '603861', '002688', '603211', '603813', '002595', '002368', '601016', '600256', '605580', '603228', '000977', '002817', '600099', '002783', '600127', '603937', '601888', '603489', '601005', '000425',
 '002875', '002004', '002950', '002807', '000789', '603002', '000897', '600801', '600692', '601339', '603331', '600638', '600785', '002777', '603690', '603169', '600624', '601088', '603078', '600546',
 '603279', '600120', '600006', '000026', '002258', '000899', '603733', '603351', '002622', '600032', '002062', '600340', '002023', '600105', '601028', '001914', '601595', '600345', '002863', '603158',
 '603139', '603348', '002780', '002385', '002283', '600897', '603183', '002128', '000088', '600399', '600935', '603960', '600917', '002800', '600279', '002728', '603693', '600329', '002726', '603458',
 '000582', '600444', '603408', '002782', '002061', '002672', '002370', '002395', '000516', '603305', '605050', '600892', '002453', '601949', '002273', '603886', '000062', '000807', '002302', '600797',
 '601666', '603060', '600809', '605305', '600757', '603595', '600016', '002043', '002736', '600192', '002416', '000761', '002831', '605116', '600128', '603618', '002758', '603000', '601038', '603680',
 '601788', '002510', '600259', '603043', '600916', '601001', '600051', '605365', '000520', '600845', '000965', '601985', '000720', '002055', '002824', '000905', '603328', '000001', '603336', '000422',
 '600900', '002850', '600761', '002153', '600771', '002714', '003042', '600353', '600738', '000035', '002847', '002674', '600227', '603191', '600167', '000733', '002632', '002361', '603866', '002460',
 '000681', '601988', '000400', '002536', '601567', '000409', '603338', '600476', '600287', '000785', '002943', '002157', '600218', '600503', '000668', '600077', '001223', '600985', '605500', '000890',
 '002428', '603111', '600819', '000567', '600869', '605089', '002658', '002197', '600561', '603716', '002816', '000910', '600786', '000655', '002103', '600999', '002317', '000584', '605056', '600489',
 '600796', '600716', '600487', '002895', '601377', '600054', '000623', '605589', '002899', '000025', '603163', '600975', '002739', '000045', '002075', '600233', '600782', '000717', '002808', '002967',
 '601010', '603888', '000718', '603662', '600604', '605008', '002059', '002665', '600702', '001217', '000426', '002327', '000816', '000798', '002287', '000710', '603155', '603629', '000059', '002533',
 '001226', '001311', '605162', '605180', '601968', '600676', '600686', '002250', '000065', '600590', '000791', '600928', '600223', '001317', '600664', '002506', '600068', '603909', '601825', '000151',
 '002337', '002438', '603227', '002544', '601952', '000050', '000533', '002786', '002161', '002558', '603286', '002047', '002472', '600745', '603015', '603356', '002203', '603700', '603936', '002375',
 '600284', '600501', '001260', '603126', '002080', '002768', '603819', '003039', '600358', '000766', '600075', '000521', '000869', '002762', '002883', '002042', '002073', '002979', '002298', '603345',
 '000518', '603087', '001218', '600133', '002403', '003001', '600825', '600228', '600486', '002247', '603628', '002236', '002737', '002155', '000408', '600711', '603713', '000938', '600238', '600661',
 '000783', '600936', '002892', '000968', '600690', '600987', '002976', '002561', '601828', '600730', '601528', '605100', '600491', '603706', '603159', '000618', '603052', '603833', '002301', '002478',
 '002048', '605069', '000089', '600461', '000589', '605178', '000852', '600446', '002002', '000953', '600396', '603332', '002404', '001209', '603878', '605577', '000605', '600658', '600418', '600063',
 '601155', '002183', '002649', '002286', '603818', '000908', '605077', '601933', '600971', '000776', '000709', '600305', '603317', '605318', '600267', '603999', '603558', '600846', '600132', '002843',
 '603939', '002180', '600858', '000833', '600908', '601228', '603333', '003032', '603131', '000988', '601133', '000729', '603042', '600685', '601838', '002449', '605186', '603178', '003030', '603006',
 '603517', '003018', '000878', '600691', '002627', '002785', '001236', '600552', '000848', '000828', '600202', '002041', '002500', '600618', '600458', '002435', '603398', '002184', '600617', '600116',
 '601811', '603500', '600058', '605399', '002702', '603977', '603280', '000027', '600644', '002285', '600807', '002331', '600663', '603922', '603678', '000055', '601882', '603195', '600372', '002963',
 '600100', '603998', '002387', '000039', '600668', '600625', '002126', '603029', '603162', '603915', '000822', '000929', '600789', '000893', '603099', '002644', '600559', '002439', '605259', '002868',
 '002087', '603392', '603118', '002410', '603053', '002135', '002012', '600419', '603538', '600026', '002778', '605198', '601007', '002408', '600572', '603466', '002670', '605258', '603168', '603001',
 '600206', '600015', '601512', '001215', '000602', '601225', '605086', '002516', '002743', '600308', '000659', '002946', '601958', '600035', '600036', '603013', '600906', '600212', '603261', '001301',
 '002873', '002040', '002532', '605168', '603150', '600918', '002013', '002666', '000925', '600355', '600072', '002196', '000515', '002345', '600717', '603578', '000778', '002681', '603609', '601898',
 '600482', '600383', '600963', '605122', '600253', '600472', '002715', '600199', '002554', '600176', '601107', '000875', '603856', '002307', '000700', '601717', '002953', '002045', '603880', '002154',
 '002367', '603226', '603790', '002085', '603757', '000821', '605336', '603730', '600751', '603182', '002343', '002992', '002185', '002451', '002223', '002114', '002144', '002213', '600569', '002559',
 '000985', '603477', '603045', '002634', '600642', '600704', '603518', '600526', '002491', '603095', '002340', '603867', '603020', '002305', '000900', '002130', '002821', '002119', '603259', '000987',
 '600592', '002423', '601916', '605136', '603533', '000156', '000100', '002593', '603817', '002424', '601766', '600059', '600048', '000021', '600066', '600151', '603363', '600076', '603958', '603955',
 '601100', '003029', '001287', '002189', '002625', '603598', '001228', '003025', '000923', '603327', '000790', '600370', '000666', '600243', '000541', '603669', '601615', '600792', '002587', '002795',
 '002585', '003004', '600794', '000912', '605189', '603081', '600187', '000632', '603444', '000685', '600317', '000961', '600363', '600392', '601200', '603607', '002761', '000505', '001979', '600864',
 '601878', '002995', '000683', '000032', '603386', '002106', '002671', '002398', '605151', '600468', '600776', '002551', '600740', '000565', '603005', '605177', '002430', '600455', '605268', '000568',
 '600648', '601658', '600367', '000554', '600479', '603579', '603113', '002171', '600603', '600125', '603648', '603179', '601633', '601136', '002848', '603505', '600095', '603237', '002490', '000759',
 '601229', '002609', '002217', '600376', '000713', '600857', '600422', '002245', '002597', '603030', '600941', '603606', '002383', '601318', '000702', '003041', '000751', '000928', '002231', '603728',
 '002984', '601606', '603879', '600562', '600499', '600769', '603898', '002629', '002988', '601258', '002709', '603613', '002898', '000556', '002662', '002067', '002351', '601778', '603041', '603033',
 '603378', '002961', '600724', '600215', '000866', '605287', '002937', '603056', '002462', '002394', '002933', '603990', '600009', '600496', '600183', '000631', '600571', '600270', '600927', '600502',
 '002457', '002806', '603038', '603519', '000990', '601880', '603188', '603070', '000958', '603507', '601607', '000536', '600157', '600368', '002278', '002917', '603601', '605158', '000678', '600512',
 '001267', '002151', '002432', '000597', '605007', '002957', '000819', '603238', '600585', '600497', '600812', '605068', '603612', '002828', '002745', '002215', '600893', '000068', '002940', '605296',
 '000628', '002248', '600010', '600958', '000956', '002386', '000711', '000006', '002568', '603260', '600038', '002483', '605009', '002146', '603508', '603665', '603698', '002972', '002600', '002570',
 '000549', '002391', '603233', '603722', '002441', '600649', '002192', '600475', '603559', '002429', '600596', '002876', '600903', '605118', '600498', '603868', '600335', '000538', '601156', '600062',
 '000815', '002037', '000966', '002829', '002667', '000831', '002172', '600821', '002840', '002420', '000755', '603008', '002276', '600566', '000726', '000070', '600478', '600863', '002452', '600529',
 '002239', '603311', '002362', '603357', '600511', '600550', '001255', '600231', '600263', '002983', '605169', '002369', '002056', '600708', '002202', '002400', '605588', '600056', '600832', '000619',
 '603329', '000526', '601992', '003022', '601022', '600535', '002779', '600523', '002027', '002931', '600855', '603630', '603200', '002206', '002405', '605319', '600660', '002679', '002378', '002275',
 '002125', '603989', '002209', '600108', '601669', '002015', '000501', '000768', '601187', '600423', '603650', '002204', '003013', '603682', '002329', '603068', '601000', '000719', '002867', '603968',
 '600160', '603365', '600735', '601966', '002598', '002939', '603639', '000046', '002107', '000576', '601789', '600137', '002212', '600982', '002949', '002856', '000063', '600020', '601678', '002862',
 '002454', '600885', '603208', '603160', '600282', '002827', '603187', '603633', '600637', '002182', '603212', '000983', '600966', '000625', '002760', '003037', '600426', '603599', '601106', '002896',
 '603326', '603110', '002642', '002170', '603309', '001300', '601198', '002292', '002512', '000559', '002539', '601188', '002353', '002767', '002832', '001313', '603222', '002907', '002765', '000817',
 '000608', '603067', '002947', '002925', '002825', '002016', '002335', '600841', '600438', '000748', '002901', '002140', '600765', '002342', '002229', '002959', '603663', '002181', '600405', '002545',
 '000417', '001332', '600155', '600609', '000756', '603306', '002822', '600190', '603385', '600285', '601990', '603535', '603383', '600037', '600079', '002752', '002379', '603166', '000935', '600551',
 '601668', '603167', '003009', '601398', '605006', '002216', '000877', '600428', '603659', '000031', '002978', '000566', '603298', '600522', '002993', '603798', '002999', '000851', '002652', '002480',
 '600727', '002798', '601858', '600774', '001230', '603105', '002689', '605286', '002922', '603527', '001258', '002124', '603153', '002912', '002150', '002033', '002093', '002264', '603918', '600409',
 '600249', '600107', '002148', '002360', '603883', '002442', '002915', '601965', '601998', '600021', '002463', '000560', '603708', '600435', '600843', '603985', '601619', '001225', '002280', '600988',
 '000812', '603396', '000610', '600703', '600926', '000338', '000019', '603836', '601900', '600201', '600166', '000301', '002686', '000957', '002054', '600171', '000416', '002191', '605188', '600679',
 '000522', '600162', '002254', '001256', '600967', '603858', '600839', '002838', '600756', '603688', '605138', '600755', '600805', '002608', '600851', '600425', '600731', '003026', '605208', '600673',
 '603151', '603058', '002116', '601999', '000404', '600787', '603009', '002399', '603096', '000661', '603028', '002121', '600017', '001368', '002091', '002864', '603235', '002341', '002242', '600631',
 '000918', '000960', '000534', '603390', '002330', '600909', '605338', '002969', '002210', '600011', '002468', '002190', '603051', '002859', '603848', '600322', '000949', '002038', '603948', '600379',
 '002207', '002284', '600800', '601696', '600421', '600118', '600195', '600965', '600763', '002049', '001286', '000825', '000573', '002630', '600320', '601688', '600234', '603318', '603956', '600071',
 '000695', '002787', '002046', '002748', '600613', '605288', '600357', '603127', '002194', '001318', '002906', '000795', '603109', '605277', '605298', '600881', '600627', '002032', '603018', '000970',
 '603173', '002381', '002735', '603997', '603439', '002208', '000811', '002017', '600750', '600380', '600023', '600179', '603197', '002565', '002338', '601061', '000650', '601555', '001202', '002837',
 '601208', '600252', '002861', '600876', '600577', '002833', '000663', '600742', '603048', '002376', '002179', '603788', '002694', '600467', '603900', '002266', '600448', '002382', '003020', '603511',
 '000003', '600398', '002562', '603071', '002654', '002426', '600620', '000002', '002902', '002890', '601808', '002396', '600481', '600310', '600288', '600336', '600373', '002132', '603266', '002601',
 '600830', '002131', '002880', '002227', '600884', '002553', '001211', '002158', '000886', '603198', '601222', '002514', '000569', '002256', '002476', '000030', '603307', '600094', '600480', '002186',
 '600835', '603121', '000590', '603021', '600229', '002731', '600318', '000859', '002582', '002513', '002508', '603206', '603755', '603101', '002519', '600362', '000921', '000591', '002389', '600361',
 '002339', '002320', '000539', '601665', '600540', '002572', '600114', '002349', '000758', '000403', '600901', '600008', '601718', '002237', '603199', '600459', '605566', '600113', '000823', '600770',
 '601908', '001259', '002371', '603066', '601231', '600844', '002557', '600586', '002729', '002732', '601066', '000503', '605117', '603928', '003023', '002288', '603636', '002626', '600861', '601059',
 '000586', '002547', '000837', '002008', '601126', '002852', '002141', '603366', '600874', '600811', '600607', '605011', '002549', '603170', '603987', '600653', '000581', '603486', '001270', '600565',
 '603738', '600410', '002246', '000153', '000667', '603711', '600612', '603667', '603156', '000967', '002065', '000975', '000888', '002105', '603313', '605300', '600808', '603055', '600299', '603297',
 '002819', '603869', '600205', '603108', '600313', '002440', '605368', '002104', '601279', '600650', '605499', '603699', '000620', '603063', '000617', '002092', '002724', '002982', '601319', '002918',
 '600619', '002577', '603192', '603703', '002418', '605599', '000989', '001283', '601866', '002678', '000401', '000540', '603696', '000406', '603027', '002811', '600539', '000529', '603176', '002596',
 '002238', '605266', '000698', '600578', '601058', '600983', '600080', '000917', '002799', '603073', '600159', '000601', '605028', '600280', '000830', '002659', '000737', '601008', '002857', '603069',
 '003006', '002066', '000762', '601816', '002163', '603986', '600760', '603282', '000777', '600211', '600729', '601995', '001339', '600082', '600826', '600416', '002096', '603377', '600531', '603501',
 '601330', '003015', '601169', '002746', '601698', '603358', '000407', '603283', '600997', '605020', '002936', '600553', '000915', '000546', '002354', '000799', '002412', '601599', '002304', '002303',
 '600348', '002397', '600959', '600815', '002849', '605058', '600307', '603337', '603991', '002643', '002053', '000014', '600866', '600655', '002007', '002920', '002945', '002051', '601997', '002646',
 '601890', '603036', '600156', '002401', '002222', '002970', '002905', '603272', '603585', '600859', '000551', '002675', '600558', '600389', '600626', '600177', '600793', '002773', '601368', '002393',
 '002431', '605369', '000690', '002444', '002657', '603588', '002455', '002747', '600623', '002050', '002019', '603520', '002010', '603389', '605090', '601399', '601238', '000547', '002866', '002306',
 '600990', '601699', '002279', '002543', '600784', '002174', '002168', '600705', '600961', '001316', '601609', '000411', '600371', '002769', '600323', '603906', '600028', '601800', '000932', '603026',
 '601186', '600622', '600743', '002162', '002314', '002255', '600836', '603180', '601168', '002789', '600216', '002771', '001229', '001328', '000563', '000885', '600436', '000728', '600500', '600791',
 '600143', '603515', '603828', '002465', '603626', '000880', '002318', '002363', '600879', '603566', '002708', '002495', '000029', '000708', '600235', '000672', '000430', '000715', '600732', '601369',
 '600178', '600580', '603815', '000722', '600698', '601163', '002095', '002274', '000810', '000159', '603388', '600986', '603258', '603399', '605366', '603577', '603657', '600158', '002101', '002980',
 '600667', '002373', '000973', '600278', '002555', '603816', '002009', '002380', '601311', '002885', '002388', '600720', '601989', '000034', '603035', '002882', '601860', '600739', '002198', '002635',
 '002159', '603590', '000800', '600576', '002169', '000607', '002682', '000881', '000906', '002308', '601177', '001231', '002409', '000517', '600097', '002214', '601827', '001268', '002232', '601089',
 '002650', '002384', '001298', '600312', '600699', '603995', '603950', '002173', '603777', '600460', '002846', '600184', '600493', '600351', '002524', '002584', '000705', '600733', '603565', '601333',
 '000527', '002788', '000903', '002952', '603668', '002297', '600111', '601956', '003027', '000750', '001266', '002826', '002893', '601002', '001896', '600088', '001208', '002617', '605155', '002489',
 '603707', '600938', '601568', '601009', '603003', '002240', '603368', '002909', '603839', '603196', '600728', '600165', '000959', '600779', '002328', '600309', '002971', '600510', '600217', '601018',
 '600630', '000040', '600297', '600853', '605123', '600004', '603610', '601677', '603908', '600000', '002225', '000999', '603059', '603299', '600519', '603717', '002647', '600939', '002355', '600170',
 '002178', '000652', '600002', '603882', '603617', '600973', '002713', '003011', '600513', '001203', '002129', '600803', '600773', '000099', '002492', '605378', '603681', '601869', '000703', '000829',
 '002774', '002523', '000519', '600007', '603100', '603916', '600889', '000593', '000950', '603887', '000727', '603967', '603689', '600746', '603269', '002886', '002717', '000797', '603615', '600469',
 '603903', '600386', '603496', '600764', '000936', '603536', '001872', '000507', '000545', '603766', '603085', '002325', '603602', '000572', '603098', '603218', '002322', '605488', '600587', '002628',
 '001965', '002941', '002855', '600777', '000767', '603767', '002693', '002120', '600060', '002294', '603429', '002639', '002505', '600718', '600737', '603065', '000813', '000524', '002295', '600633',
 '002741', '600339', '002528', '000418', '002487', '001206', '002648', '600888', '002546', '000736', '000627', '600292', '603089', '605018', '603920', '600039', '002466', '600449', '002589', '002193',
 '002079', '603201', '600992', '600377', '603660', '600131', '605377', '000078', '603825', '603901', '600919', '603859', '600326', '603803', '600715', '600230', '603219', '600998', '600689', '002616',
 '002251', '000558', '000933', '003038', '600070', '600186', '002137', '603976', '002576', '600657', '002932', '002541', '600833', '003002', '600641', '002290', '002165', '002938', '603255', '600962',
 '605388', '000592', '603083', '002690', '003010', '002573', '601636', '601598', '002981', '002796', '000826', '600189', '002115', '002542', '000415', '001338', '002419', '000725', '002956', '600706',
 '002352', '002889', '000952', '600012', '000639', '002467', '002291', '000090', '002921', '603676', '603726', '000058', '601127', '002526', '603040', '002989', '600549', '601886', '600991', '600378',
 '603012', '002790', '603605', '603116', '002282', '603789', '601166', '601969', '002531', '600369', '002025', '600886', '603291', '002201', '002205', '000679', '600736', '002897', '600283', '603181',
 '000665', '002057', '605228', '600085', '603268', '600064', '603506', '600834', '000543', '002853', '600548', '603661', '600753', '002469', '000978', '603136', '001210', '000901', '601139', '002484',
 '001314', '600537', '603220', '002550', '603992', '600390', '003033', '002599', '601872', '600602', '603316', '603023', '601939', '600848', '002571', '600507', '002753', '601901', '002078', '603727',
 '002725', '601199', '600197', '603080', '605358', '001234', '002566', '000011', '600628', '002928', '600161', '601798', '002638', '603881', '002527', '600831', '002471', '603129', '600439', '001216',
 '603885', '603077', '002574', '600710', '002534', '002919', '601111', '600783', '603895', '603871', '000976', '600517', '002502', '000061', '601618', '000782', '605166', '000048', '000555', '603949',
 '002265', '600860', '603683', '603133', '600665', '603086', '601702', '603057', '002721', '002669', '002911', '603687', '603737', '603125', '001333', '000920', '600150', '000909', '000803', '000963',
 '000739', '601121', '601390', '000060', '600488', '000862', '002083', '000863', '600536', '603931', '603213', '002333', '601518', '603929', '601996', '002556', '600325', '002869', '605339', '605303',
 '600185', '002797', '600768', '000861', '605333', '600968', '000008', '002612', '603739', '600905', '002110', '000788', '000537', '600582', '603189', '002631', '600956', '603701', '601728', '605567',
 '000420', '002035', '603725', '603017', '002152', '002624', '600643', '601211', '601777', '002133', '603569', '000020', '001696', '601456', '001289', '002673', '003007', '601162', '600220', '600538',
 '002088', '002703', '601099', '002836', '603315', '600360', '002613', '002637', '600415', '603267', '000024', '002623', '002029', '601608', '603516', '002588', '002357', '600193', '002390', '002117',
 '600875', '601727', '002348', '002221', '600775', '600296', '002664', '603658', '600466', '600838', '002434', '000578', '002315', '600031', '603106', '000423', '603103', '002044', '002705', '605108',
 '002334', '000937', '000622', '600818', '600346', '002923', '002660', '000651', '603186', '600281', '603616', '600722', '603330', '000157', '002820', '002112', '600693', '000962', '600053', '002603',
 '002392', '002916', '601360', '601799', '603963', '002443', '002094', '601101', '600316', '002319', '000598', '000550', '002734', '603899', '002252', '001222', '000671', '601065', '002871', '605080',
 '600333', '603759', '002733', '603290', '002365', '002521', '000779', '600406', '600321', '600208', '600109', '002461', '000514', '002425', '600188', '000402', '603171', '600713', '002803', '600610',
 '002326', '600338', '002267', '600573', '000600', '000792', '600635', '002835', '000017', '002583', '600828', '600827', '000510', '601226', '000596', '002602', '002805', '603838', '603773', '002127',
 '600196', '601689', '603132', '600871', '003000', '002845', '000599', '002910', '003017', '603600', '603776', '002243', '600433', '000595', '002081', '600865', '002108', '600925', '601375', '600106',
 '603589', '600141', '603811', '000818', '600651', '000858', '002003', '601801', '001366', '603321', '002750', '600255', '603416', '002481', '603860', '002235', '002986', '002685', '002579', '600597',
 '603185', '600257', '603387', '601015', '603335', '603190', '601137', '600258', '601298', '600867', '002134', '600820', '600102', '002998', '603969', '002167', '000911', '600050', '001367', '600219',
 '002567', '600490', '600327', '603115', '002518', '002695', '600061', '002156', '603927', '603061', '002097', '601616', '601116', '002332', '603779', '603488', '002522', '600877', '001288', '002727',
 '600629', '600266', '002594', '002241', '002997', '600298', '600420', '605598', '603677', '600758', '001308', '603289', '600795', '002160', '601921', '002511', '603980', '003019', '603037', '002606',
 '002913', '002060', '603897', '002772', '000069', '002415', '600862', '600248', '601519', '600810', '600682', '605005', '601068', '000508', '600200', '000998', '600979', '601919', '600894', '600350',
 '002823', '002706', '600180', '600684', '601021', '000037', '600463', '603530', '600477', '601881', '600268', '600222', '600802', '603583', '000588', '000656', '000155', '000919', '003012', '000603',
 '603421', '600121', '002698', '603360', '600115', '601579', '603889', '002775', '000916', '603666', '603808', '600824', '600067', '002962', '001336', '002881', '600584', '000562', '002615', '002985',
 '603938', '000056', '002036', '002830', '000504', '002749', '603787', '002973', '002955', '600895', '603203', '603580', '000010', '002498', '601118', '600521', '000997', '002891', '603979', '002475',
 '600976', '000868', '603079', '600203', '605001', '000738', '000421', '600662', '002111', '601928', '600029', '002271', '600868', '002187', '600456', '002641', '600397', '002530', '002098', '600251',
 '600332', '000731', '600849', '603586', '000635', '600594', '002028', '002942', '603239', '002068', '000028', '603019', '603456', '603637', '603232', '603369', '600882', '001331', '001296', '000688',
 '002865', '003008', '605337', '600130', '600375', '603709', '002610', '603165', '605099', '603685', '002218', '600837', '600129', '600749', '603209', '002138', '002082', '603177', '002696', '600119',
 '603855', '601336', '002262', '600331', '002228', '002118', '601611', '002281', '000528', '002407', '000513', '002887', '601233', '600452', '601818', '603011', '601158', '600101', '600153', '000036',
 '002344', '603529', '603970', '002636', '002142', '600557', '600169', '002538', '603281', '002011', '000066', '600829', '603768', '002723', '000553', '002756', '002099', '600933', '603893', '603379',
 '000892', '002884', '605398', '603890', '600354', '002560', '000735', '600276', '600250', '600126', '002620', '600152', '600790', '600560', '603917', '600055', '603993', '600315', '000982', '002578',
 '603303', '000898', '603786', '600744', '603016', '601700', '600873', '002633', '601011', '600005', '600955', '002494', '600272', '002474', '603216', '600366', '000544', '002488', '002406', '002926',
 '601138', '601868', '603926', '600778', '000333', '000692', '603112', '000753', '002802', '603256', '600400', '603025', '600712', '600237', '002346', '002812', '600575', '600236', '000636', '002977',
 '600033', '600840', '000716', '601326', '600395', '603308', '600570', '002244', '002020', '603320', '600688', '603130', '002312', '600295', '601991', '002479', '002324', '002968', '001330', '601299',
 '600148', '603221', '002842', '000876', '000913', '002990', '600207', '002661', '603567', '601601', '002763', '603896', '002277', '603393', '601577', '600681', '600269', '000158', '002645', '601963',
 '002738', '002497', '001201', '600213', '600138', '605299', '002687', '603355', '002691', '001309', '600996', '002030', '000955', '601918', '600495', '001219', '002261', '002074', '002930', '603225',
 '001360', '000561', '002253', '000931', '600429', '605111', '603367', '600567', '600022', '600528', '002655', '000801', '000701', '003036', '600293', '600588', '603656', '600842', '601865', '002507',
 '003035', '002813', '000996', '000922', '002166', '002701', '000570', '002272', '002718', '603686', '002459', '600725', '601600', '002564', '600683', '001207', '600381', '603090', '002520', '600352',
 '600980', '600583', '600089', '601003', '002614', '601218', '000860', '001323', '002299', '600117', '603919', '002372', '001337', '000548', '002224', '600817', '603088', '002927', '601117', '002991',
 '605133', '002537', '600533', '603022', '605088', '600995', '002697', '600232', '002552', '603556', '002164', '002621', '000926', '002139', '603809', '003031', '600640', '002935', '002900', '601069',
 '002870', '603380', '002270', '002929', '603982', '000691', '605060', '002818', '603983', '600611', '002026', '600675', '603778', '600645', '600149', '003021', '600019', '002364', '603822', '605081',
 '600018', '000712', '603135', '002851', '600647', '600741', '002581', '603324', '001322', '002039', '000626', '605376', '000677', '002084', '600723', '600337', '605222', '600822', '603551', '605066',
 '601019', '000429', '600104', '600172', '001299', '600359', '002310', '000096', '002651', '002300', '603300', '003003', '601857', '002006', '603823', '600210', '600887', '000531', '605199', '000637',
 '002965', '600579', '603797', '600081', '003005', '600110', '600697', '000049', '601628', '000676', '600027', '002234', '603217', '000721', '002437', '002176', '002722', '603323', '600694', '603608',
 '600328', '000836', '600545', '600173', '603031', '603718', '000657', '002145', '600103', '000793', '002548', '600277', '001269', '002755', '603959', '601686', '600052', '603619', '002296', '603801',
 '603093', '000856', '002815', '603721', '600563', '002064', '000557', '603712', '600854', '605389', '603988', '002841', '002801', '605218', '603758', '603353', '003040', '002456', '605098', '600984',
 '600605', '002100', '600547', '600343', '600356', '601388', '000882', '600636', '600969', '002347', '600929', '000428', '605128', '002563', '002663', '603877', '601216', '600168', '002791', '001227',
 '600993', '600678', '601012', '002421', '603236', '002445', '002493', '002975', '600135', '600556', '002759', '002676', '000498', '603528', '603050', '001213', '002908', '002446', '002879', '002350',
 '600520', '001205', '000850', '001319', '002001', '002683', '601899', '000615', '002540', '000680', '003816', '603933', '001238', '001278', '600525', '600823', '600505', '601328', '600098', '601288',
 '000532', '000723', '600330', '600483', '002289', '002123', '002960', '601077', '000930', '600674', '002402', '600516', '600527', '002374', '002839', '000488', '002529', '601236', '002311', '002195',
 '603587', '002109', '603161', '002580', '002448', '000838', '000757', '603322', '600606', '600872', '600273', '000015', '002077', '603223', '600714', '002458', '600271', '002611', '002716', '002199',
 '603978', '603876', '600616', '002422', '600025', '002503', '002987', '002414', '002712', '600754', '002590', '600246', '000883', '003016', '002809', '601566', '002090', '600123', '603301', '000969',
 '002230', '603799', '002486', '002792', '605255', '600632', '000009', '603215', '600748', '002336', '600883', '603097', '603277', '601975', '600639', '600780', '000419', '601588', '000506', '600847',
 '600508', '002966', '603319', '002858', '000951', '600880', '600073', '603966', '002707', '002149', '000629', '600163', '600977', '002996', '603123', '000023', '000686', '000542', '601500', '002233',
 '601006', '000948', '003043', '600621', '000552', '002263', '603359', '600989', '605003', '000927', '002014', '600598', '600850', '000633', '601366', '600470', '601128', '002948', '605167', '000763',
 '603843', '600707', '603288', '002903', '603102', '000530', '002377', '000012', '603229', '603010', '002436', '600262', '001212', '600509', '002958', '000016', '000682', '002034', '002293', '603611',
 '000042', '002888', '605183', '603638', '603214', '600001', '603128', '601877', '600970', '605196', '002677', '600981', '002226', '603912', '603679', '603138', '002810', '600798', '600543', '603719',
 '601515', '603800', '603339', '002877', '000786', '002951', '000413', '605555', '605033', '603826', '603076', '601179', '000166', '002793', '002249', '002860', '603829', '605016', '603810', '002605',
 '002878', '003028', '002730', '002607', '002136', '600096', '601098', '600960', '002413', '600530', '603697', '603230', '000895', '600391', '603655', '603568', '000612', '002591', '002269', '603499',
 '605055', '600600', '002757', '600302', '605179', '603806', '601929', '600581', '603596', '600696', '600261']

#code_list = ['000403']


user_agent_list = ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36 Edg/100.0.1185.29",
                   "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36",
                   'Mozilla/5.0 (compatible; U; ABrowse 0.6; Syllable) AppleWebKit/420+ (KHTML, like Gecko)', 'Mozilla/5.0 (compatible; U; ABrowse 0.6;  Syllable) AppleWebKit/420+ (KHTML, like Gecko)', 'Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; Acoo Browser 1.98.744; .NET CLR 3.5.30729)', 'Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; Acoo Browser 1.98.744; .NET CLR   3.5.30729)', 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0;   Acoo Browser; GTB5; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;   SV1) ; InfoPath.1; .NET CLR 3.5.30729; .NET CLR 3.0.30618)', 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; SV1; Acoo Browser; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; Avant Browser)', 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1;   .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)', 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; GTB5; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ; Maxthon; InfoPath.1; .NET CLR 3.5.30729; .NET CLR 3.0.30618)', 'Mozilla/4.0 (compatible; Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; Acoo Browser 1.98.744; .NET CLR 3.5.30729); Windows NT 5.1; Trident/4.0)', 'Mozilla/4.0 (compatible; Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; GTB6; Acoo Browser; .NET CLR 1.1.4322; .NET CLR 2.0.50727); Windows NT 5.1; Trident/4.0; Maxthon; .NET CLR 2.0.50727; .NET CLR 1.1.4322; InfoPath.2)',
                   'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; Acoo Browser; GTB6; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ; InfoPath.1; .NET CLR 3.5.30729; .NET CLR 3.0.30618)']

headers = {"user-agent": random.choice(user_agent_list),}


url = "http://money.finance.sina.com.cn/quotes_service/api/json_v2.php/CN_MarketData.getKLineData?symbol=sz000002&scale=5&ma=5&datalen=1023"
day_list = []
res = requests.get(url=url)
for li in res.json():
    day = li.get("day")[:10]
    if day not in day_list:
        day_list.append(day)

day_list = day_list[1:]
print(day_list)
for day in day_list[-1:]:
    des_code_list = []
    for code in code_list:
        #logging.info(day_list[-2])
        day_data_url = "http://q.stock.sohu.com/hisHq?code=cn_{0}&start={1}&end={2}".format(code, day.replace("-", ""), day.replace("-", ""))
        z_day_data_url = "http://q.stock.sohu.com/hisHq?code=cn_{0}&start={1}&end={2}".format(code, day_list[-2].replace("-", ""), day_list[-2].replace("-", ""))     
        sz_day_data_url = "http://q.stock.sohu.com/hisHq?code=cn_{0}&start={1}&end={2}".format(code, day_list[-3].replace("-", ""), day_list[-3].replace("-", ""))
        try: 
            #print(day_data_url)
            tmp_response_1 = requests.get(url=day_data_url, headers=headers).json()
            #logging.info(tmp_response_1)
            z_tmp_response_1 = requests.get(url=z_day_data_url, headers=headers).json()
            sz_tmp_response_1 = requests.get(url=sz_day_data_url, headers=headers).json()
            #logging.info(z_tmp_response_1)
            tmp_response = tmp_response_1[0].get("hq")[0]
            z_tmp_response = z_tmp_response_1[0].get("hq")[0]
            sz_tmp_response = sz_tmp_response_1[0].get("hq")[0]
        except Exception as e:
            #print(111111)
            #if 2 == tmp_response_1[0].get("status"):
            logging.info("111111", e, code)
                
            continue
        
        #logging.info("7777777777777777")
        zhang_fu = float(tmp_response[4][:-1])
        huan_shou = float(tmp_response[-1][:-1])
        #shou_shu = float(tmp_response[-3])
        cheng_jiao_liang = float(tmp_response[-2])/ 10000
        shou_pan_jia = float(tmp_response[2])
        z_shou_pan_jia = float(z_tmp_response[2])
        #print(z_shou_pan_jia)
        sz_shou_pan_jia = float(sz_tmp_response[2])
        zui_di_jia = float(tmp_response[5])
        kai_pan_jia = float(tmp_response[1])
        #shang_ying_xian = (float(tmp_response[-4]) - float(tmp_response[2])) / float(tmp_response[2])
        shang_ying_xian = float(tmp_response[-4]) / (float(tmp_response[2])/(zhang_fu/100 + 1)) - 1 - zhang_fu/100
        #print(shang_ying_xian, float(tmp_response[-4]), float(tmp_response[2]), zhang_fu)
        #print(float(tmp_response[-4]), float(tmp_response[2]))
        #print("666666666666")
        #logging.info("7777777777777777")
        if (1.5< zhang_fu < 6) and cheng_jiao_liang > 1 and shou_pan_jia > kai_pan_jia and shang_ying_xian < 0.05:
            #print("4444444444")
            ma_url="https://stockapi.com.cn/v1/quota/ma?token=a20428f5bc97e60c6918a15e032079b41a3872df60575e1d&code={0}&date={1}&ma=5,10,20,30,60,250&rehabilitation=100&calculationCycle=100".format(code, day)
            week_ma_url="https://stockapi.com.cn/v1/quota/ma?token=a20428f5bc97e60c6918a15e032079b41a3872df60575e1d&code={0}&date={1}&ma=5,10,20,30,60,250&rehabilitation=100&calculationCycle=101".format(code, day)
            z_ma_url="https://stockapi.com.cn/v1/quota/ma?token=a20428f5bc97e60c6918a15e032079b41a3872df60575e1d&code={0}&date={1}&ma=5,10,20,30,60,250&rehabilitation=100&calculationCycle=100".format(code, day_list[-2])
            z_week_ma_url="https://stockapi.com.cn/v1/quota/ma?token=a20428f5bc97e60c6918a15e032079b41a3872df60575e1d&code={0}&date={1}&ma=5,10,20,30,60,250&rehabilitation=100&calculationCycle=101".format(code, day_list[-2])
            #print(ma_url)
            res_1 = requests.get(url=ma_url)
            res_2 = requests.get(url=week_ma_url)
            z_res_1 = requests.get(url=z_ma_url)
            z_res_2 = requests.get(url=z_week_ma_url)
            #print(res_1.json())
            try:
                ma_data = res_1.json().get("data")
                ma_data_list = []
                if ma_data.get("ma5"):
                    ma_data_list.append(ma_data.get("ma5"))
                if ma_data.get("ma10"):
                    ma_data_list.append(ma_data.get("ma10"))
                if ma_data.get("ma20"):
                    ma_data_list.append(ma_data.get("ma20"))
                if ma_data.get("ma30"):
                    ma_data_list.append(ma_data.get("ma30"))
                if ma_data.get("ma60"):
                    ma_data_list.append(ma_data.get("ma60"))
                if ma_data.get("ma250"):
                    ma_data_list.append(ma_data.get("ma250"))
           
                week_ma_data = res_2.json().get("data")
                week_ma_data_list = []
                if week_ma_data.get("ma5"):
                    week_ma_data_list.append(week_ma_data.get("ma5"))
                if week_ma_data.get("ma10"):
                    week_ma_data_list.append(week_ma_data.get("ma10"))
                if week_ma_data.get("ma20"):
                    week_ma_data_list.append(week_ma_data.get("ma20"))
                if week_ma_data.get("ma30"):
                    week_ma_data_list.append(week_ma_data.get("ma30"))
                if week_ma_data.get("ma60"):
                    week_ma_data_list.append(week_ma_data.get("ma60"))
                if week_ma_data.get("ma250"):
                    week_ma_data_list.append(week_ma_data.get("ma250"))
                ma_data_list = [float(x) for x in ma_data_list]
                max_ma = max(ma_data_list)
                week_ma_data_list = [float(x) for x in week_ma_data_list]
                week_max_ma = max(week_ma_data_list)


                z_ma_data = z_res_1.json().get("data")
                z_ma_data_list = []
                if z_ma_data.get("ma5"):
                    z_ma_data_list.append(z_ma_data.get("ma5"))
                if z_ma_data.get("ma10"):
                    z_ma_data_list.append(z_ma_data.get("ma10"))
                if z_ma_data.get("ma20"):
                    z_ma_data_list.append(z_ma_data.get("ma20"))
                if z_ma_data.get("ma30"):
                    z_ma_data_list.append(z_ma_data.get("ma30"))
                if z_ma_data.get("ma60"):
                    z_ma_data_list.append(z_ma_data.get("ma60"))
                if z_ma_data.get("ma250"):
                    z_ma_data_list.append(z_ma_data.get("ma250"))
           
                z_week_ma_data = z_res_2.json().get("data")
                z_week_ma_data_list = []
                if z_week_ma_data.get("ma5"):
                    z_week_ma_data_list.append(z_week_ma_data.get("ma5"))
                if week_ma_data.get("ma10"):
                    z_week_ma_data_list.append(z_week_ma_data.get("ma10"))
                if z_week_ma_data.get("ma20"):
                    z_week_ma_data_list.append(z_week_ma_data.get("ma20"))
                if z_week_ma_data.get("ma30"):
                    z_week_ma_data_list.append(z_week_ma_data.get("ma30"))
                if z_week_ma_data.get("ma60"):
                    z_week_ma_data_list.append(z_week_ma_data.get("ma60"))
                if z_week_ma_data.get("ma250"):
                    z_week_ma_data_list.append(z_week_ma_data.get("ma250"))
                z_ma_data_list = [float(x) for x in z_ma_data_list]
                z_max_ma = max(z_ma_data_list)
                z_week_ma_data_list = [float(x) for x in z_week_ma_data_list]
                z_week_max_ma = max(z_week_ma_data_list)

                #logging.info(str(shou_pan_jia) + "---" + str(max_ma) + "--" + str(week_max_ma) + "--" + str(sz_shou_pan_jia) + "--" + str(z_week_max_ma) + "--" + str(len(z_week_ma_data_list)) + "--" + str(z_max_ma))
                m = n = 0
                if shou_pan_jia >= week_max_ma and sz_shou_pan_jia < z_week_max_ma and 6 == len(z_week_ma_data_list):
                    #logging.info("1111111")
                    #print(type(z_week_max_ma))
                    #print(type(z_week_ma_data.get("ma250")))
                    if z_week_max_ma == float(z_week_ma_data.get("ma250")):
                        m = 1
                        #logging.info("222222222")
                #print(z_shou_pan_jia, z_max_ma, len(z_ma_data_list))
                if z_shou_pan_jia < z_max_ma and 6 == len(z_ma_data_list):
                    #logging.info("33333333333")
                    if z_max_ma == float(z_ma_data.get("ma250")):
                        #logging.info("4444444444")
                        n = 1
                if shou_pan_jia > max_ma and (m or n):
                    code_1 = "sz" + code if "00" == code[:2] else "sh" + code
                    name_url = "http://qt.gtimg.cn/q={0}".format(code_1)
                    name = requests.get(name_url).text.split("~")[1]
                    logging.info(str(day) + str(name))
                    #print(i.get("f12"))
            
            except Exception as e:
                print(e)
                #if 2 == tmp_response_1[0].get("status"):
                logging.info("222222", e)
                
                continue
    
